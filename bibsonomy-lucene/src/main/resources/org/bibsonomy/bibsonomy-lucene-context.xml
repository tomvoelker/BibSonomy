<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:util="http://www.springframework.org/schema/util"
	xsi:schemaLocation="http://www.springframework.org/schema/beans
						http://www.springframework.org/schema/beans/spring-beans.xsd
						http://www.springframework.org/schema/util
						http://www.springframework.org/schema/util/spring-util-3.0.xsd">


	<bean id="luceneResourceFactory" class="org.bibsonomy.model.factories.ResourceFactory" />

	<bean id="luceneBookmarkClass" class="java.lang.Class" factory-method="forName">
		<constructor-arg value="org.bibsonomy.model.Bookmark" />
	</bean>

	<bean id="lucenePublicationClass" class="java.lang.Class" factory-method="forName">
		<constructor-arg value="org.bibsonomy.model.BibTex" />
	</bean>

	<bean id="luceneGoldStandardPublicationClass" class="java.lang.Class" factory-method="forName">
		<constructor-arg value="org.bibsonomy.model.GoldStandardPublication" />
	</bean>


	<bean id="realSharedIndexUpdatePlugin" class="org.bibsonomy.es.SharedIndexUpdatePlugin" lazy-init="true" abstract="true">
		<constructor-arg ref="esClient"/>
		<constructor-arg value="${project.home}"/>
		<constructor-arg ref="lucenePublicationConverter"/>
	</bean>
	
	<bean id="realSharedIndexUpdatePluginForPublications" lazy-init="true" parent="realSharedIndexUpdatePlugin">
		<property name="dbLogic" ref="lucenePublicationLogic"/>
	</bean>
	<bean id="sharedIndexUpdatePluginForPublications" class="org.bibsonomy.webapp.util.spring.factorybeans.ConditionedFactoryBean">
		<property name="condition" ref="esClusterNamePresent" />
		<lookup-method name="produceSucessBean" bean="realSharedIndexUpdatePluginForPublications" />
	</bean>
	
	<bean id="realSharedIndexUpdatePluginForBookmarks" lazy-init="true" parent="realSharedIndexUpdatePlugin">
		<property name="dbLogic" ref="luceneBookmarkLogic"/>
	</bean>
	<bean id="sharedIndexUpdatePluginForBookmarks" class="org.bibsonomy.webapp.util.spring.factorybeans.ConditionedFactoryBean">
		<property name="condition" ref="esClusterNamePresent" />
		<lookup-method name="produceSucessBean" bean="realSharedIndexUpdatePluginForBookmarks" />
	</bean>
	
	<bean id="realSharedIndexUpdatePluginForGoldStandardPublications" lazy-init="true" parent="realSharedIndexUpdatePlugin">
		<property name="dbLogic" ref="luceneGoldStandardPublicationLogic"/>
	</bean>
	<bean id="sharedIndexUpdatePluginForGoldStandardPublications" class="org.bibsonomy.webapp.util.spring.factorybeans.ConditionedFactoryBean">
		<property name="condition" ref="esClusterNamePresent" />
		<lookup-method name="produceSucessBean" bean="realSharedIndexUpdatePluginForGoldStandardPublications" />
	</bean>
	
	<bean id="realEsPublicationSearch" lazy-init="true" parent="abstractEsResourceSearch">
		<property name="resourceType" value="BibTex"/>
		<property name="resourceConverter" ref="lucenePublicationConverter" />
	</bean>
	<bean id="esPublicationSearch" class="org.bibsonomy.webapp.util.spring.factorybeans.ConditionedFactoryBean">
		<property name="condition" ref="esClusterNamePresent" />
		<lookup-method name="produceSucessBean"  bean="realEsPublicationSearch" />
	</bean>
	
	<bean id="realEsBookmarkSearch" lazy-init="true" parent="abstractEsResourceSearch">
		<property name="resourceType" value="Bookmark"/>
		<property name="resourceConverter" ref="luceneBookmarkConverter" />
	</bean>
	<bean id="esBookmarkSearch" class="org.bibsonomy.webapp.util.spring.factorybeans.ConditionedFactoryBean">
		<property name="condition" ref="esClusterNamePresent" />
		<lookup-method name="produceSucessBean" bean="realEsBookmarkSearch"/>
	</bean>
	
	<bean id="realEsGoldStandardSearch" lazy-init="true" parent="abstractEsResourceSearch">
		<property name="resourceType" value="GoldStandardPublication"/>
		<property name="resourceConverter" ref="luceneGoldStandardPublicationConverter" />
	</bean>
	<bean id="esGoldStandardSearch" class="org.bibsonomy.webapp.util.spring.factorybeans.ConditionedFactoryBean">
		<property name="condition" ref="esClusterNamePresent" />
		<lookup-method name="produceSucessBean" bean="realEsGoldStandardSearch"/>
	</bean>

	<bean id="esClusterNamePresent" class="org.bibsonomy.webapp.util.spring.condition.NonEmptyStringCondition">
		<property name="value" value="${es.cluster.name}" />
	</bean>

	


	<!-- <bean id= "esClient" class= "org.bibsonomy.es.ESNodeClient"/> -->

	<bean id="esClient" class="org.bibsonomy.es.ESTransportClient" lazy-init="true" init-method="init">
		<property name="esAddresses" value="${es.address}"/>
		<property name="esClusterName" value="${es.cluster.name}"/>
	</bean>

	<bean id="abstractEsResourceSearch" class="org.bibsonomy.es.EsResourceSearch" abstract="true">
		<property name="esClient" ref="esClient"/>
	</bean>



	<!--+ | lucene post converter + -->
	<!-- abstract converter -->
	<bean id="lucenePostConverter" class="org.bibsonomy.lucene.index.converter.LuceneResourceConverter" abstract="true">
		<property name="resourceFactory" ref="luceneResourceFactory" />
	</bean>

	<bean id="lucenePublicationConverter" class="org.bibsonomy.lucene.index.converter.LuceneResourceConverter" parent="lucenePostConverter">
		<property name="postPropertyMap" ref="publicationPropertyMap" />
		<property name="resourceClass" ref="lucenePublicationClass" />
	</bean>

	<bean id="luceneBookmarkConverter" class="org.bibsonomy.lucene.index.converter.LuceneResourceConverter" parent="lucenePostConverter">
		<property name="postPropertyMap" ref="bookmarkPropertyMap" />
		<property name="resourceClass" ref="luceneBookmarkClass" />
	</bean>

	<bean id="luceneGoldStandardPublicationConverter" class="org.bibsonomy.lucene.index.converter.LuceneResourceConverter" parent="lucenePostConverter">
		<property name="postPropertyMap" ref="publicationPropertyMap" />
		<property name="resourceClass" ref="luceneGoldStandardPublicationClass" />
	</bean>


	<!-- abstract resource index -->
	<bean id="luceneResourceIndex" class="org.bibsonomy.lucene.index.LuceneResourceIndex" abstract="true">
		<property name="baseIndexPath" value="${lucene.index.basePath}" />
	</bean>

	<util:list id="bookmarkIndeces">
		<bean id="luceneBookmarkIndex0" class="org.bibsonomy.lucene.index.LuceneResourceIndex" init-method="init" parent="luceneResourceIndex">
			<property name="indexId" value="0" />
			<property name="analyzer" ref="luceneBookmarkFieldWrapperAnalyzer" />
			<property name="resourceClass" ref="luceneBookmarkClass" />
			<property name="resourceConverter" ref="luceneBookmarkConverter" />
		</bean>
		<bean id="luceneBookmarkIndex1" class="org.bibsonomy.lucene.index.LuceneResourceIndex" init-method="init" parent="luceneResourceIndex">
			<property name="indexId" value="1" />
			<property name="analyzer" ref="luceneBookmarkFieldWrapperAnalyzer" />
			<property name="resourceClass" ref="luceneBookmarkClass" />
			<property name="resourceConverter" ref="luceneBookmarkConverter" />
		</bean>
	</util:list>

	<util:list id="publicationIndeces">
		<bean id="lucenePublicationIndex0" class="org.bibsonomy.lucene.index.LuceneResourceIndex" init-method="init" parent="luceneResourceIndex">
			<property name="indexId" value="0" />
			<property name="analyzer" ref="lucenePublicationFieldWrapperAnalyzer" />
			<property name="resourceClass" ref="lucenePublicationClass" />
			<property name="resourceConverter" ref="lucenePublicationConverter" />
		</bean>
		<bean id="lucenePublicationIndex1" class="org.bibsonomy.lucene.index.LuceneResourceIndex" init-method="init" parent="luceneResourceIndex">
			<property name="indexId" value="1" />
			<property name="analyzer" ref="lucenePublicationFieldWrapperAnalyzer" />
			<property name="resourceClass" ref="lucenePublicationClass" />
			<property name="resourceConverter" ref="lucenePublicationConverter" />
		</bean>
	</util:list>

	<util:list id="goldStandardPublicationIndeces">
		<bean id="goldStandardPublicationIndex0" class="org.bibsonomy.lucene.index.LuceneResourceIndex" init-method="init" parent="luceneResourceIndex">
			<property name="indexId" value="0" />
			<property name="analyzer" ref="lucenePublicationFieldWrapperAnalyzer" />
			<property name="resourceClass" ref="luceneGoldStandardPublicationClass" />
			<property name="resourceConverter" ref="luceneGoldStandardPublicationConverter" />
		</bean>
		<bean id="goldStandardPublicationIndex1" class="org.bibsonomy.lucene.index.LuceneResourceIndex" init-method="init" parent="luceneResourceIndex">
			<property name="indexId" value="1" />
			<property name="analyzer" ref="lucenePublicationFieldWrapperAnalyzer" />
			<property name="resourceClass" ref="luceneGoldStandardPublicationClass" />
			<property name="resourceConverter" ref="luceneGoldStandardPublicationConverter" />
		</bean>
	</util:list>

	<!--+ 
	    | lucene database access logics
	    + -->
	<bean id="luceneSqlMapClient" class="org.springframework.orm.ibatis.SqlMapClientFactoryBean">
		<property name="dataSource" ref="luceneDataSource" />
		<property name="configLocation" value="classpath:SqlMapConfig_lucene.xml" />
		<property name="transactionConfigClass" value="com.ibatis.sqlmap.engine.transaction.jdbc.JdbcTransactionConfig" />
	</bean>

	<bean id="luceneSessionFactory" class="org.bibsonomy.database.common.impl.SqlMapClientDBSessionFactory">
		<property name="client" ref="luceneSqlMapClient" />
	</bean>

	<bean id="luceneDBLogic" class="org.bibsonomy.lucene.database.LuceneDBLogic" abstract="true">
		<property name="sessionFactory" ref="luceneSessionFactory" />
	</bean>

	<bean id="lucenePublicationLogic" class="org.bibsonomy.lucene.database.LuceneDBLogic" parent="luceneDBLogic">
		<property name="resourceClass" ref="lucenePublicationClass" />
	</bean>
	<bean id="luceneBookmarkLogic" class="org.bibsonomy.lucene.database.LuceneDBLogic" parent="luceneDBLogic">
		<property name="resourceClass" ref="luceneBookmarkClass" />
	</bean>
	<bean id="luceneGoldStandardPublicationLogic" class="org.bibsonomy.lucene.database.LuceneGoldStandardLogic" parent="luceneDBLogic">
		<property name="resourceClass" ref="luceneGoldStandardPublicationClass" />
	</bean>

	<!--+
	    | lucene index searcher 
	    + -->
	<bean id="luceneInfoDBLogic" class="org.bibsonomy.lucene.database.LuceneInfoDBLogic">
		<property name="sessionFactory" ref="luceneSessionFactory" />
	</bean>

	<bean id="luceneResourceSearch" class="org.bibsonomy.lucene.search.LuceneResourceSearch" abstract="true">
		<property name="tagCloudLimit" value="${lucene.tagCloud.limit}" />
		<property name="tagCloudEnabled" value="${lucene.tagCloud.enabled}" />
		<property name="dbLogic" ref="luceneInfoDBLogic" />
	</bean>

	<bean id="lucenePublicationSearch" class="org.bibsonomy.lucene.search.LucenePublicationSearch" parent="luceneResourceSearch">
		<property name="analyzer" ref="lucenePublicationFieldWrapperAnalyzer" />
		<property name="resourceConverter" ref="lucenePublicationConverter" />
		<property name="sharedResourceSearch" ref="esPublicationSearch"/>
	</bean>

	<bean id="luceneBookmarkSearch" class="org.bibsonomy.lucene.search.LuceneResourceSearch" parent="luceneResourceSearch">
		<property name="analyzer" ref="luceneBookmarkFieldWrapperAnalyzer" />
		<property name="resourceConverter" ref="luceneBookmarkConverter" />
		<property name="sharedResourceSearch" ref="esBookmarkSearch"/>
	</bean>

	<bean id="luceneGoldStandardPublicationSearch" class="org.bibsonomy.lucene.search.LucenePublicationSearch" parent="luceneResourceSearch">
		<property name="analyzer" ref="lucenePublicationFieldWrapperAnalyzer" />
		<property name="resourceConverter" ref="luceneGoldStandardPublicationConverter" />
		<property name="sharedResourceSearch" ref="esGoldStandardSearch"/>
	</bean>

	<!--+ 
        | lucene index manager 
        + -->
	<bean id="luceneResourceManager" class="org.bibsonomy.lucene.index.manager.LuceneResourceManager" abstract="true">
		<property name="luceneUpdaterEnabled" value="${lucene.enableUpdater}" />
	</bean>

	<bean id="lucenePublicationManager" class="org.bibsonomy.lucene.index.manager.LuceneResourceManager" init-method="init" parent="luceneResourceManager">
		<property name="resourceIndices" ref="publicationIndeces" />
		<property name="dbLogic" ref="lucenePublicationLogic" />
		<property name="searcher" ref="lucenePublicationSearch" />
		<property name="resourceConverter" ref="lucenePublicationConverter" />
		<property name="plugins">
			<list>
				<ref bean="sharedIndexUpdatePluginForPublications" />
			</list>
		</property>
	</bean>

	<bean id="luceneBookmarkManager" class="org.bibsonomy.lucene.index.manager.LuceneResourceManager" init-method="init" parent="luceneResourceManager">
		<property name="resourceIndices" ref="bookmarkIndeces" />
		<property name="dbLogic" ref="luceneBookmarkLogic" />
		<property name="searcher" ref="luceneBookmarkSearch" />
		<property name="resourceConverter" ref="luceneBookmarkConverter" />
		<property name="plugins">
			<list>
				<ref bean="sharedIndexUpdatePluginForBookmarks" />
			</list>
		</property>
	</bean>

	<bean id="luceneGoldStandardPublicationManager" class="org.bibsonomy.lucene.index.manager.LuceneGoldStandardManager" init-method="init" parent="luceneResourceManager">
		<property name="resourceIndices" ref="goldStandardPublicationIndeces" />
		<property name="dbLogic" ref="luceneGoldStandardPublicationLogic" />
		<property name="searcher" ref="luceneGoldStandardPublicationSearch" />
		<property name="resourceConverter" ref="luceneGoldStandardPublicationConverter" />
		<property name="plugins">
			<list>
				<ref bean="sharedIndexUpdatePluginForGoldStandardPublications" />
			</list>
		</property>
	</bean>

	<util:map id="allLuceneResourceManagers" key-type="java.lang.Class">
		<entry key-ref="luceneBookmarkClass" value-ref="luceneBookmarkManager" />
		<entry key-ref="lucenePublicationClass" value-ref="lucenePublicationManager" />
		<entry key-ref="luceneGoldStandardPublicationClass" value-ref="luceneGoldStandardPublicationManager" />
	</util:map>

	<!-- #################### imports #################### -->
	<import resource="bibsonomy-lucene-index-config.xml" />

	<!--+ 
	    | import resource field configurations 
	    + -->
	<import resource="bibsonomy-lucene-post-fields.xml" />
	<import resource="bibsonomy-lucene-publication-fields.xml" />
	<import resource="bibsonomy-lucene-bookmark-fields.xml" />
</beans>
