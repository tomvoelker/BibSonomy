<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE urlrewrite PUBLIC "-//tuckey.org//DTD UrlRewrite 2.6//EN"
        "http://tuckey.org/res/dtds/urlrewrite2.6.dtd">

<!--
	Configuration file for UrlRewriteFilter 
	http://tuckey.org/urlrewrite/
-->
<urlrewrite>

	<!--  
		  the following rule is a quick switch between the "old" resourcehandler
	      pages and thew new Spring MVC pages. If uncommented, the request attribute
	      "type" will be set for each request - which has the consequence that
	      each request is answered by the "old" system.
	        dbe, 20080124 	      
	-->
	
	<!-- 
	<rule>
		<from>.*</from>		
		<set name="type">USE_OLD_PAGES</set>		
	</rule>
	 -->	

    <rule>
        <note>
            The rule means that requests to /test/status/ will be redirected to /rewrite-status
            the url will be rewritten.
        </note>
        <from>/test/status/</from>
        <to type="redirect">/rewrite-status</to>
    </rule>

<!--START some servlets for testing purposes (new MVC implementation)  -->

	<rule>
		<from>/brokenurl.*</from>
		<to>/brokenurl.html</to>
	</rule>


<!-- ############## feeds / export formats ###############
     
     PLEASE NOTE: 
     During the migration to the new Spring-MVC framework, the distinction which feed 
     is served by the old / new framework is done via the request attribute set name=...:
     
       <set name="format">...: NEW PAGES (Spring-MVC)
       <set name="type">...  : OLD PAGES (Resourcehandler)
       
     dbe, 20080115            
-->
    <!-- FEED overview page -->
	<rule>
		<from>^/+export/+(.*)$</from>

		<to last="true">/export.jsp</to>
		<set name="requPath">$1</set>
	</rule>
    <!-- RSS feed for bookmarks, output generated by jsp/export/bookmark/rssfeed.jspx -->	
    <rule>
    	<from>^/+rss/+(.*)$</from>
    	<to last="false">/$1</to>
    	<set name="format">rss</set>
    </rule>
    <!-- RSS feed for publications, output generated by jsp/export/bibtex/rssfeed.jspx -->
    <rule>
    	<from>^/+publrss/+(.*)$</from>
    	<to last="false">/$1</to>
    	<set name="format">publrss</set>

    </rule>
    <!-- APARSS feed for publications, output generated by jsp/export/bibtex/aparssfeed.jspx -->
    <rule>
    	<from>^/+aparss/+(.*)$</from>
    	<to last="false">/$1</to>
    	<set name="format">aparss</set>
    </rule>
    <!-- 
    	XML output for bookmarks, output generated by jsp/export/bookmark/xmlOutput.jspx
    	changed back to old system - output has to be checked first (dbe, 20080117) 
    -->
    <rule>
    	<from>^/+xml/+(.*)$</from>
    	<to last="false">/$1</to>
    	<set name="type">xml</set>
    </rule>    
    
    <!-- NRL (Nepomuk Representation Language) output for bookmarks, output generated by NRLOutput.jsp -->
    <rule>

    	<from>^/+nrl/+(.*)$</from>
    	<to last="false">/$1</to>
    	<set name="type">nrl</set>
    </rule>
    
    <!-- BibTeX output for publications, output generated by jsp/export/bibtex/bibtex.jspx -->
    <rule>
    	<from>^/+bib/+(.*)$</from>
    	<to last="false">/$1</to>
    	<set name="format">bibtex</set>
    </rule>
    <!-- BibTeX output for bookmarks, output generated by BibBookOutput.jsp-->
    <rule>
    	<from>^/+bookbib/+(.*)$</from>
    	<to last="false">/$1</to>
    	<set name="type">bookbib</set>
    </rule>    
    <!-- SWRC output for publications, output generated by jsp/export/bibtex/swrc.jspx -->
    <rule>
    	<from>^/+swrc/+(.*)$</from>
    	<to last="false">/$1</to>
    	<set name="format">swrc</set>

    </rule>
    <!-- BuRST output generated by BuRSToutput.jsp -->
    <rule>
    	<from>^/+burst/+(.*)$</from>
    	<to last="false">/$1</to>
    	<set name="format">burst</set>
    </rule>

    <!-- EndNote output for publications, output generated by EndnoteOutput.jsp -->
    <rule>
    	<from>^/+endnote/+(.*)$</from>
    	<to last="false">/$1</to>
    	<set name="type">endnote</set>
    </rule>
    <!-- formated output of publications, output generated by jsp/export/bibtex/htmlOutput.jspx -->

    <rule>
    	<from>^/+publ/+(.*)$</from>
    	<to last="false">/$1</to>
    	<set name="format">publ</set>
    </rule>
    
    <!-- formated output of bookmarks, output generated by jsp/export/bookmark/bookpubl.jspx-->
    <rule>
    	<from>^/+bookpubl/+(.*)$</from>
    	<to last="false">/$1</to>
    	<set name="format">bookpubl</set>
    </rule>
    
    <!-- formated output of publications, output generated by JSONOutput.jsp 
    <rule>
    	<from>^/+json/+(.*)$</from>
    	<to last="false">/$1</to>
    	<set name="type">json</set>
    </rule> -->
    <rule>
    	<from>^/+layout/+(.+?)/+(.*)$</from>
    	<to last="false">/$2</to>
    	<set name="type">layout</set>
    	<set name="layout">$1</set>
    </rule>
    <!--  special rule for formating KDE publications -->
    <rule>
    	<from>^/+publkde/+(.*)$</from>
    	<to last="false">/$1</to>
    	<set name="type">publkde</set>
    </rule>
    <!--  special rule for formating publications as CSV -->
    <rule>
    	<from>^/+publcsv/+(.*)$</from>
    	<to last="false">/$1</to>
    	<set name="type">publcsv</set>

    </rule>
    <!--  special rule for formating Nepomuk publications -->
    <rule>
    	<from>^/+publrssN/+(.*)$</from>
    	<to last="false">/$1</to>
    	<set name="type">publrssN</set>
    </rule>



    <!-- 
    	page where user can edit all tags in a batch
    	NOTE: this is still directed to "old" resourcehandler pages in all cases
    	by later conditions (dbe, 20070115)  
    -->   
    <rule>
    	<from>^/+bediturl/+(.*)$</from>
    	<to last="false">/$1</to>
    	<set name="type">batchediturl</set>
    </rule>
    <rule>
    	<from>^/+beditbib/+(.*)$</from>
    	<to last="false">/$1</to>
    	<set name="type">batcheditbib</set>
    </rule>


	<!--  store requested path for each query -->
	<rule>
		<from>^/+(.+)$</from>		
		<set name="requPath">$1</set>		
	</rule>
	
	<!-- ensure compatibility to old bookmark / bibtex start / end params -->
	<rule>
		<from>^/+(.*startBib=(\d+).*)$</from>
		<to last="false">/$1&amp;bibtex.start=$2</to>
	</rule>
	<rule>
		<from>^/+(.*startBook=(\d+).*)$</from>
		<to last="false">/$1&amp;bookmark.start=$2</to>
	</rule>
	<rule>
		<from>^/+(.*items=(\d+).*)$</from>
		<to last="false">/$1&amp;bookmark.entriesPerPage=$2&amp;bibtex.entriesPerPage=$2</to>
	</rule>

        <!-- necessary to keep jabref exports valid until they are migrated -->
        <rule>
                <from>^/+(.*bibtex.entriesPerPage=(\d+).*)$</from>
                <to last="false">/$1&amp;items=$2</to>
        </rule>

<!-- ############## general pages ############### -->

	<!-- homepage -->
	<rule>
	    <!-- workaround to redirect not-yet-supported features to old resource handler -->
		<condition type="parameter" name="filter" operator="notequal"/>
		<condition type="attribute" name="type" operator="notequal"/>	
		<from>^/+(\?(.*))?$</from>
		<!-- NEW PAGE -->
		<to>/homepage?$2</to>
	</rule>
	<rule>
		<from>^/+(\?(.*))?$</from>
		<!-- OLD PAGE -->
		<to>/ResourceHandler?page=home&amp;$2</to>
	</rule>	
    <rule>
        <from>^/+popular(\?(.*))?$</from>
        <to>/ResourceHandler?page=popular&amp;$2</to>
    </rule>
	<!-- download a document -->
    <rule>
		<from>^/+documents/(.+?)(\?(.*))?$</from>
		<to>/DocumentDownloadHandler?requHash=$1&amp;$3</to> 
	</rule>	
	<!-- download a picture -->
    <rule>
		<from>^/+images/+([0-9a-fA-F]{32})/+(.+?)?$</from>
		<to>/PictureDownloadHandler?requHash=$1&amp;requUser=$2</to> 
	</rule>


<!-- ############## user pages ############### -->
    <!-- redirect for tag formular on /concept/user/USER/TAG page -->
    <rule>
    <!-- workaround to redirect not-yet-supported features to old resource handler -->
		<condition type="parameter" name="filter" operator="notequal"/>
		<condition type="attribute" name="type" operator="notequal"/>
        <from>^/+concept/+user/+([^/?]+?)/(.+?)(\?(.*))?$</from>
        <to>/concept?requestedUser=$1&amp;requestedTags=$2</to>
    </rule>    
    <!-- OLD PAGE -->
    <rule>
        <from>^/+concept/+user/+([^/?]+?)/(.+?)(\?(.*))?$</from>
        <to>/ResourceHandler?page=concept&amp;requUser=$1&amp;requTag=$2&amp;$4</to>
    </rule>   
     <rule>
        <from>^/+concept/+user/+([^/?]+?)(\?tag=(.*))$</from>
        <to type="redirect">/concept/user/$1/$3</to>
    </rule> 
    
    <!-- redirect for tag formular on /concept/group/GROUPNAME/TAG page -->
    <rule>
    <!-- workaround to redirect not-yet-supported features to old resource handler -->		
        <from>^/+concept/+group/+([^/?]+?)/(.+?)(\?(.*))?$</from>
        <to>/concept?requestedGroup=$1&amp;requestedTags=$2</to>
    </rule>    
    
   	<!-- redirect for tag formular on /user/USER/TAG page -->
    <rule>
      <from>^/+user/+([^/?]+?)(\?tag=(.*))$</from>
      <to type="redirect">/user/$1/$3</to>
    </rule>
    <!-- redirect for user formular on /user/USER page -->
    <rule>
      <from>^/+user/(\?user=(.*))$</from>
      <to type="redirect">/user/$2</to>
    </rule>
    <!-- /user/USER/TAG -->
    <rule>
    	<!-- workaround to redirect not-yet-supported features to old resource handler -->
		<condition type="parameter" name="filter" operator="notequal"/>
		<condition type="attribute" name="type" operator="notequal"/>    
    	<from>^/+user/+([^/?]+?)/(.+?)(\?(.*))?$</from>
    	<!-- NEW PAGE -->
    	<to>/user?requestedUser=$1&amp;requestedTags=$2&amp;$4</to> 
    </rule>
    <rule>
        <from>^/+user/+([^/?]+?)/(.+?)(\?(.*))?$</from>
        <!-- OLD PAGE -->
        <to>/ResourceHandler?page=usertag&amp;requUser=$1&amp;requTag=$2&amp;$4</to>
    </rule>


    <!-- /user/USER -->
	<rule>
	    <!-- workaround to redirect not-yet-supported features to old resource handler -->
		<condition type="parameter" name="filter" operator="notequal"/>
		<condition type="attribute" name="type" operator="notequal"/>
		<from>^/+user/+([^/?]+?)(\?(.*))?$</from>
		<!-- NEW PAGE -->
		<to>/user?requestedUser=$1&amp;$3</to>
	</rule>	
	<rule>		
		<from>^/+user/+([^/?]+?)(\?(.*))?$</from>
		<!-- OLD PAGE -->
		<to>/ResourceHandler?page=user&amp;requUser=$1&amp;$3</to>
	</rule>	

	<rule>
		<from>^/+user/+([^/?]+?)(\?(.*filter=.*))$</from>
		<to>/ResourceHandler?page=user&amp;requUser=$1&amp;$3</to>
	</rule>	
	<rule>
		<from>^/+user/+([^/?]+?)/$</from>
		<to type="redirect">/user/$1</to>
	</rule>
	
	<!-- redirect for FOAF Output of user profile on /foaf/user/USER page -->
    <rule>
      <from>^/+foaf/+user/(\?user=(.*))$</from>
      <to type="redirect">/foaf/user/$2</to>
    </rule>
    <rule>
      <from>^/+foaf/+user/+([^/?]+?)(\?(.*))?$</from>
      <to>/UserFOAFOutput.jsp?requUser=$1&amp;$3</to>
    </rule>
    
    <!-- redirect for /bibtexkey/BIBTEXKEY -->
    <rule><!-- /bibtexkey/?key=BIBTEXKEY -->
      <from>^/+bibtexkey/(\?key=(.*))$</from>
      <to type="redirect">/bibtexkey/$2</to>
    </rule>	
    <rule>
      <from>^/+bibtexkey/+(.+)(\?(.*))?$</from>
 <!--     <to>/ResourceHandler?page=bibtexkey&amp;requestKey=$1&amp;$2</to> -->
 		<to>/bibtexkey?requestKey=$1&amp;$2</to> 
    </rule>    
	
		
<!-- ############## viewable pages ############### -->
    <rule> 
    	<condition type="parameter" name="filter" operator="notequal"/>
		<condition type="attribute" name="type" operator="notequal"/>  
        <from>^/+viewable/+([^/?]+?)/(.+?)(\?(.*))?$</from>
        <!-- NEW PAGE -->
        <to>/viewable?requestedGroup=$1&amp;requestedTags=$2&amp;$4</to>
    </rule>   	
    <rule> <!-- /viewable/GROUP/TAG -->
        <from>^/+viewable/+([^/?]+?)/(.+?)(\?(.*))?$</from>
        <!-- OLD PAGE -->
        <to>/ResourceHandler?page=viewabletag&amp;requGroup=$1&amp;requTag=$2&amp;$4</to>
    </rule>
    <!-- redirect for tag formular on /viewable/GROUP/TAG page -->
    <rule>
      <from>^/+viewable/+([^/?]+?)(\?tag=(.*))$</from>
      <to type="redirect">/viewable/$1/$3</to>
    </rule>
    <rule> 
	    <condition type="parameter" name="filter" operator="notequal"/>
		<condition type="attribute" name="type" operator="notequal"/>  
		<from>^/+viewable/+([^/?]+?)(\?(.*))?$</from>
		<!-- NEW PAGE -->
		<to>/viewable?requestedGroup=$1&amp;$3</to>
	</rule>
	<rule> <!-- /viewable/GROUP -->
		<from>^/+viewable/+([^/?]+?)(\?(.*))?$</from>
		<!-- OLD PAGE -->
		<to>/ResourceHandler?page=viewable&amp;requGroup=$1&amp;$3</to>
	</rule>	    
	<rule>
	  <from>^/+viewable/+([^/?]+?)/$</from>
	  <to type="redirect">/viewable/$1</to>
	</rule>


<!-- ############## group pages ############### -->
    <rule> <!-- /group/GROUP/TAG -->
    	<!-- workaround to redirect not-yet-supported features to old resource handler -->
		<condition type="parameter" name="filter" operator="notequal"/> 
		<condition type="attribute" name="type" operator="notequal"/>     
        <from>^/+group/+([^/?]+?)/(.+?)(\?(.*))?$</from> 
		<!-- NEW PAGE -->      
        <to>/group?requestedGroup=$1&amp;requestedTags=$2&amp;$4</to> 
        <!-- <to>/ResourceHandler?page=grouptag&amp;requGroup=$1&amp;requTag=$2&amp;$4</to> -->
    </rule>
    <rule> 
        <from>^/+group/+([^/?]+?)/(.+?)(\?(.*))?$</from>
        <!-- OLD PAGE -->
        <to>/ResourceHandler?page=grouptag&amp;requGroup=$1&amp;requTag=$2&amp;$4</to>
    </rule>    
    <!-- redirect for tag formular on /group/GROUP/TAG page -->
    <rule>
      <from>^/+group/+([^/?]+?)(\?tag=(.*))$</from>
      <to type="redirect">/group/$1/$3</to>
    </rule>
	<rule> <!-- /group/GROUP -->
    	<!-- workaround to redirect not-yet-supported features to old resource handler -->
		<!-- <condition type="parameter" name="filter" operator="notequal"/> -->
		<condition type="attribute" name="type" operator="notequal"/>    	
		<from>^/+group/+([^/?]+?)(\?(.*))?$</from>
		<!-- NEW PAGE -->
		<to>/group?requestedGroup=$1&amp;$3</to>
		<!--<to>/ResourceHandler?page=group&amp;requGroup=$1&amp;$3</to>-->
	</rule>
	<rule> 	
		<from>^/+group/+([^/?]+?)(\?(.*))?$</from>
		<!-- OLD PAGE -->
		<to>/ResourceHandler?page=group&amp;requGroup=$1&amp;$3</to>
	</rule>	
	<!-- /groups -->
    <rule>
      <from>^/+group/(\?group=(.*))$</from>
      <to type="redirect">/group/$2</to>
    </rule>
	<rule>
	    <from>^/+group/*$</from>
	    <to>/groups.jsp</to>
	</rule>
	<rule>
	    <from>^/+groups/*$</from>
	    <to>/groups.jsp</to>
	</rule>
	<rule>
	  <from>^/+group/+([^/?]+?)/$</from>
	  <to type="redirect">/group/$1</to>
	</rule>

<!-- ############## friends pages ############### -->
    <rule> <!-- /friend/USER/TAG -->
        <from>^/+friend/+([^/?]+?)/(.+?)(\?(.*))?$</from>
        <to>/ResourceHandler?page=frienduser&amp;requUser=$1&amp;requTag=$2&amp;$4</to>
    </rule>
    <!-- redirect for tag formular on /friend/USER/TAG page -->
    <rule>
      <from>^/+friend/+([^/?]+?)(\?tag=(.*))$</from>
      <to type="redirect">/friend/$1/$3</to>
    </rule>
	<rule> <!-- /friend/USER -->
		<from>^/+friend/+([^/?]+?)(\?(.*))?$</from>
		<to>/ResourceHandler?page=frienduser&amp;requUser=$1&amp;$3</to>
	</rule>
	<!-- /friends -->
    <rule>
      <from>^/+friends/(\?user=(.*))$</from>
      <to type="redirect">/friend/$2</to>
    </rule>
	<rule>
	    <from>^/+friend/*(\?(.*))?$</from>
  		<to>/ResourceHandler?page=friend&amp;$2</to>
	</rule>
	<rule>
	    <from>^/+friends/*(\?(.*))?$</from>
  		<to>/ResourceHandler?page=friend&amp;$2</to>	    
	</rule>
	<rule>
	  <from>^/+friend/+([^/?]+?)/$</from>
	  <to type="redirect">/friend/$1</to>
	</rule>


<!-- ############## tag pages ############### -->
	<!-- redirect for tag formular on /tag page -->
	<rule>
     	<from>^/+tag/(\?tag=(.*))$</from>
     	<to type="redirect">/tag/$2</to>
    </rule>
    <!-- tags -->
	<rule>
	    <from>^/+tags/*$</from>
	    <to>/tags.jsp</to>
	</rule>
	<rule>
	    <from>^/+tag/*$</from>
	    <to type="redirect">/tags</to>
	</rule>
	<rule> <!-- /tag/TAG -->
    	<!-- workaround to redirect not-yet-supported features to old resource handler -->
		<condition type="parameter" name="filter" operator="notequal"/>
		<condition type="attribute" name="type" operator="notequal"/>    	
		<from>^/+tag/(.+?)(\?(.*))?$</from>
		<!-- NEW PAGE -->
		<to>/tag?requestedTags=$1&amp;$3</to>
	</rule>
	<rule>
		<!-- OLD PAGE -->
		<from>^/+tag/(.+?)(\?(.*))?$</from>
		<to>/ResourceHandler?page=tag&amp;requTag=$1&amp;$3</to>
	</rule>
	    
    <!-- redirect for tag formular on /concept/tag/TAG page -->
    <rule>
        <from>^/+concept/+tag/(\?tag=(.*))$</from>
        <to type="redirect">/concept/tag/$2</to>
    </rule>
    
    <rule> <!-- /concept/tag/CONCEPT -->
    <!-- workaround to redirect not-yet-supported features to old resource handler -->
		<condition type="parameter" name="filter" operator="notequal"/>
		<condition type="attribute" name="type" operator="notequal"/>
        <from>^/+concept/+tag/(.+?)(\?(.*))?$</from>
        <!-- NEW PAGE -->
        <to>/concept?requestedTags=$1&amp;$3</to>
    </rule>     
    <!-- OLD PAGE -->
    <rule>
        <from>^/+concept/+tag/(.+?)(\?(.*))?$</from>
        <to>/ResourceHandler?page=concept&amp;requTag=$1&amp;$3</to>
    </rule>
    
<!-- ############## author pages ############### -->    
    <rule> <!-- /author/AUTHOR/TAG -->
        <from>^/+author/+([^/?]+?)/(.+?)(\?(.*))?$</from>
        <!-- OLD PAGE -->
        <to>/ResourceHandler?page=authortag&amp;requAuthor=$1&amp;requTag=$2&amp;$4</to>
    </rule>   
    <rule> 
    	<!-- workaround to redirect not-yet-supported features to old resource handler -->
		<condition type="parameter" name="filter" operator="notequal"/>
		<condition type="attribute" name="type" operator="notequal"/>     
        <from>^/+author/+([^/?]+?)/(.+?)(\?(.*))?$</from> 
		<!-- NEW PAGE -->      
         <to>/author?requestedAuthor=$1&amp;requestedTags=$2&amp;$4</to>
    </rule>
    
    <!-- redirect for tag formular on /author/AUTHOR/TAG page -->
    <rule>
      <from>^/+author/+([^/?]+?)(\?tag=(.*))$</from>
      <to type="redirect">/author/$1/$3</to>
    </rule>	
	<!-- redirect for author formular on /author/AUTHORNAME page -->
    <rule>
      <from>^/+author/(\?author=(.*))$</from>
      <to type="redirect">/author/$2</to>
    </rule>	
    <rule><!-- /author/AUTHOR -->
		<from>^/+author/(.+?)(\?(.*))?$</from>
		<!-- OLD PAGE -->
		<to>/ResourceHandler?page=author&amp;requAuthor=$1&amp;$3</to>
	</rule>    
    <rule>
		<from>^/+author/(.+?)(\?(.*))?$</from>
		<!-- NEW PAGE -->
		<to>/author?requestedAuthor=$1&amp;$3</to> 
	</rule>
	

<!-- ############## url hashes ############### -->
	<rule>
	    <from>^/+url/*$</from>
	    <to type="redirect">/</to>
	</rule>
	<rule>
		<from>^/+url\?url=(.*)$</from>
		<to>/RedirectHandler?page=url&amp;requUrl=$1</to> 
	</rule>
	<rule>
		<from>^/+url/+([0-9a-fA-F]+)(\?(.*))?$</from>
		<to>/ResourceHandler?page=url&amp;requUrl=$1&amp;$3</to> 
	</rule>
	<rule>
		<from>^/+url/+([0-9a-fA-F]+)/+(.+?)(\?(.*))?$</from>
		<to>/ResourceHandler?page=userurl&amp;requUrl=$1&amp;requUser=$2&amp;$4</to> 
	</rule>

<!-- ############## publ hashes ############### -->
	<!-- JSON -->
	<rule>
		<from>^/+json/+tags/+bibtex/+([0-9a-fA-F]*)(\?(.*))?$</from>
		<to type="redirect">/bibtex/$1?format=json&amp;restrictToTags=true&amp;$3</to>		
	</rule>	
	
    <!-- pick right sim hash type -->
	<rule><!-- /[32]/user -->
		<from>^/+bibtex/+([0-9a-fA-F]{32})/+(.+?)(\?(.*))?$</from>
		<to>/ResourceHandler?page=userbibtex&amp;requBibtex=$1&amp;requSim=0&amp;requUser=$2&amp;$4</to> 
	</rule>
	<rule><!-- /[32] -->
		<condition type="parameter" name="restrictToTags" operator="notequal"/>
		<from>^/+bibtex/+([0-9a-fA-F]{32})(\?(.*))?$</from>
		<to>/ResourceHandler?page=bibtex&amp;requBibtex=$1&amp;requSim=1&amp;$3</to> 
	</rule>
	<!-- sim hash type explicitly given -->
	<rule><!-- /[0-3][32]/user -->
		<from>^/+bibtex/+([0-3])([0-9a-fA-F]{32})/+(.+?)(\?(.*))?$</from>
		<to>/ResourceHandler?page=userbibtex&amp;requBibtex=$2&amp;requSim=$1&amp;requUser=$3&amp;$5</to> 
	</rule>
	<rule><!-- /[0-3][32] -->
		<condition type="parameter" name="restrictToTags" operator="notequal"/> 
		<from>^/+bibtex/+([0-3])([0-9a-fA-F]{32})(\?(.*))?$</from>
		<to>/ResourceHandler?page=bibtex&amp;requBibtex=$2&amp;requSim=$1&amp;$4</to> 
	</rule>
	
	<!-- NEW PAGE -->
	<rule><!-- /[0-3][32] -->
		<from>^/+bibtex/+([0-3])([0-9a-fA-F]{32})(\?(.*))?$</from>
		<to>/bibtex?requBibtex=$2&amp;requSim=$1&amp;$4</to> 
	</rule>	
	<rule><!-- arbitrary hash -->
		<from>^/+bibtex/+([0-9a-fA-F]*)(\?(.*))?$</from>
		<to>/bibtex?requBibtex=$1&amp;requSim=1&amp;$3</to> 
	</rule>	
	
	
<!-- ############## geotagging hashes ############### -->
	<rule><!-- /[32]/user -->
		<from>^/+geotagging/+([0-9a-fA-F]{32})/+(.+?)?$</from>
		<!-- <from>^/+geotagging/+([0-9a-fA-F]{32})/+(.+?)(\?(.*))?$</from> -->
		<to>/geotagging_entry.jsp?requUser=$2&amp;requHash=$1</to> 
	</rule>

<!-- ############## search pages ############### -->
    <!-- redirect for search formular on /search/SEARCHTERM page -->
    <rule>
      <from>^/+search(\?search=(.*))$</from>
      <to type="redirect">/search/$2</to>
    </rule>	
    <rule>
		<from>^/+search\?(.*)$</from>
		<!-- NEW PAGE -->
		<to>/search?requestedSearch=$1</to> 
	</rule>
  	<rule>
		<from>^/+search/(.+?)(\?(.*))?$</from>
		<!-- NEW PAGE -->
		<to>/search?requestedSearch=$1&amp;$3</to> 
	</rule>
	
	
	<!-- ############## admin pages ############### -->
	<rule>     	
        <from>^/+admin(\?(.*))?$</from> 
         <to>/admin?$2</to>
    </rule>
    
    <!-- ############## ajax ############### -->
	<rule>     	
        <from>^/+ajax(\?(.*))?$</from> 
         <to>/ajax?$2</to>
    </rule>


	
	<!-- search for tags or users -->
    <rule>
		<from>^/+specialsearch\?(.*)$</from>
		<to>/RedirectHandler?page=specialsearch&amp;$1</to> 
	</rule>	

<!-- ############## content negotiation ############### -->
	<!-- Bibtex -->		
	<rule><!-- /uri/bibtex/hash -->
		<from>^/+uri/+bibtex/+([0-3])([0-9a-fA-F]{32})(\?(.*))?$</from>
		<to>/RedirectHandler?page=uri&amp;requResource=bibtex&amp;requContent=$1$2&amp;$4</to> 
	</rule>	
	<rule><!-- /uri/bibtex/hash/username -->
		<from>^/+uri/+bibtex/+([0-3])([0-9a-fA-F]{32})/+(.+?)(\?(.*))?$</from>
		<to>/RedirectHandler?page=uri&amp;requResource=bibtex&amp;requContent=$1$2&amp;requContent2=$3&amp;$5</to> 
	</rule>
	<rule><!-- /uri/bibtexkey/key/user -->
		<!--  <from>^/+uri/+bibtexkey/+([^/?]+?)/+(.+?)(\?(.*))?$</from> -->
		<from>^/+uri/+bibtexkey/+(.+)/+(.+?)(\?(.*))?$</from>
		<to>/RedirectHandler?page=uri&amp;requResource=bibtexkey&amp;requContent=$1&amp;requContent2=$2&amp;$4</to> 
	</rule>
	
	<!-- Bookmarks -->
	<rule><!-- /uri/url/hash -->
		<from>^/+uri/+url/([0-9a-fA-F]{32})(\?(.*))?$</from>
		<to>/RedirectHandler?page=uri&amp;requResource=url&amp;requContent=$1&amp;$3</to> 
	</rule>
	<rule><!-- /uri/url/hash/username -->
		<from>^/+uri/+url/([0-9a-fA-F]{32})/+(.+?)(\?(.*))?$</from>
		<to>/RedirectHandler?page=uri&amp;requResource=url&amp;requContent=$1&amp;requContent2=$2&amp;$4</to> 
	</rule>
	
	<!-- Authors -->
	<rule><!-- /uri/author/authorname/tagname -->
		<from>^/+uri/+author/+([^/?]+?)/(.+?)(\?(.*))?$</from>
		<to>/RedirectHandler?page=uri&amp;requResource=author&amp;requContent=$1&amp;requContent2=$2&amp;$4</to>
	</rule>
	<rule><!-- /uri/author/authorname -->
		<from>^/+uri/+author/(.+?)(\?(.*))?$</from>
		<to>/RedirectHandler?page=uri&amp;requResource=author&amp;requContent=$1&amp;$3</to>
	</rule>	

<!-- ############## other pages ############### -->
	<rule>
		<from>^/+relations/+([^/?]+?)(\?(.*))?$</from>
		<to>/userRelations?requUser=$1&amp;$3</to>
	</rule>
	<rule>
		<from casesensitive="true">^/+relations</from>
		<to>/allRelations</to>
	</rule>
    <rule><!-- old one, can be removed one day -->
        <from>^/+download(\?(.*))?$</from>
        <to>/ResourceHandler?page=basket&amp;$2</to>
    </rule>
    <rule>
        <from>^/+basket(\?(.*))?$</from>
        <to>/ResourceHandler?page=basket&amp;$2</to>
    </rule>

	<outbound-rule>
        <note>
            The outbound-rule specifies that when response.encodeURL is called (if you are using JSTL c:url)
            the url /rewrite-status will be rewritten to /test/status/.

            The above rule and this outbound-rule means that end users should never see the
            url /rewrite-status only /test/status/ both in thier location bar and in hyperlinks
            in your pages.
        </note>
        <from>/rewrite-status</from>
        <to>/test/status/</to>
    </outbound-rule>

</urlrewrite>
