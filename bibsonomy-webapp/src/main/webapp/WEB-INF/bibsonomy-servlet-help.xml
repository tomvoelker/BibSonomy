<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:util="http://www.springframework.org/schema/util"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.springframework.org/schema/beans 
	                    http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
	                    http://www.springframework.org/schema/util 
	                    http://www.springframework.org/schema/util/spring-util-3.0.xsd">
	                    
	<bean id="helpUrlMapping" parent="urlMapping" class="org.springframework.web.servlet.handler.SimpleUrlHandlerMapping">
		<property name="urlMap">
			<map merge="true">
				<entry key="/help">
					<bean parent="controllerBase">
						<property name="controllerBeanName" value="helpPageController"/>
						<property name="allowedFields">
							<list>
								<value>language</value>
								<value>helpPage</value>
								<value>filename</value>
								<value>theme</value>
								<value>search</value>
							</list>
						</property>
					</bean>
				</entry>
			</map>
		</property>
	</bean>
	
	<bean id="helpPath" class="java.lang.String">
		<constructor-arg value="${project.help.path}" />
	</bean>
	
	<bean id="helpPageController" class="org.bibsonomy.webapp.controller.help.HelpPageController" scope="request">
		<property name="projectName" ref="projectName" />
		<property name="projectTheme" ref="projectTheme" />
		<property name="projectHome" ref="projectHome" />
		<property name="projectEmail" ref="projectEmail" />
		<property name="projectNoSpamEmail" ref="projectNoSpamEmail" />
		<property name="requestLogic" ref="requestLogic" />
		<property name="responseLogic" ref="responseLogic" />
		<property name="urlGenerator" ref="relativeUrlGenerator" />
		<property name="search" ref="helpSearchManager" />
		<property name="helpPath" ref="helpPath" />
	</bean>
	
	<bean id="markdownFactory" class="org.bibsonomy.webapp.util.markdown.MarkdownHelpPageParserFactory" />
	
	<bean id="helpSearchManager" class="org.bibsonomy.search.es.help.HelpSearchManager">
		<property name="path" ref="helpPath" />
		<property name="projectName" ref="projectName"/>
		<property name="projectTheme" ref="projectTheme"/>
		<property name="projectHome" ref="projectHome" />
		<property name="projectEmail" ref="projectEmail" />
		<property name="projectNoSpamEmail" ref="projectNoSpamEmail" />
		<property name="client" ref="esClient" />
		<property name="factory" ref="markdownFactory" />
		<property name="urlGenerator" ref="relativeUrlGenerator" />
		<property name="indexingDisabled" value="#{!isValidESConnection}" />
	</bean>
</beans>