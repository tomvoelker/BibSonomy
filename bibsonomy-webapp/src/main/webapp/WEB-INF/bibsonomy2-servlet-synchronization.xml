<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:util="http://www.springframework.org/schema/util"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.springframework.org/schema/beans 
	                    http://www.springframework.org/schema/beans/spring-beans.xsd
	                    http://www.springframework.org/schema/util
	                    http://www.springframework.org/schema/util/spring-util-3.0.xsd">

	<!--  #################### url mapping #################### -->
    <bean id="synchronizationUrlMapping" parent="urlMapping" class="org.springframework.web.servlet.handler.SimpleUrlHandlerMapping">
		<property name="urlMap">
			<map merge="true">
			    
			    <!-- update synchronization settings -->
			    <entry key="/updateSyncSettings">
			    	<bean parent="controllerBase">
			    		<property name="controllerBeanName" value="updateSyncSettingsController"/>
			    		<property name="allowedFields">
			    			<list>
			    				<value>ckey</value>
			    				<value>syncService.service</value>
			    				<value>syncService.serverUser[*]</value>
			    				<value>action</value>
			    			</list>
			    		</property>
			    	</bean>
			    </entry>
			    <entry key="/syncpage">
					<bean parent="controllerBase">
						<property name="controllerBeanName" value="syncPageController"/>						
					</bean>
				</entry>
				
				<entry key="/ajax/synchronize">
					<bean parent="controllerBase">
					<property name="controllerBeanName" value ="syncController"/>
					<property name="allowedFields">
						<list>
							<value>serviceName</value>
							<value>syncBookmarks</value>
							<value>syncPublications</value>
						</list>
					</property> 
					</bean>
				</entry>
				
				<entry key="/admin/sync">
					<bean parent ="controllerBase">
						<property name="controllerBeanName" value = "adminSyncController"/>
						<property name="allowedFields">
						<list>
							<value>action</value>
							<value>service</value>
							<value>server</value>
						</list>
						</property>
					</bean>
				</entry>
            </map>
        </property>
    </bean>
	
	<!--  #################### controller #################### -->
	
	<!-- handles sync admin page -->
	<bean id="adminSyncController" class="org.bibsonomy.webapp.controller.admin.AdminSyncViewController" scope="request">
		<property name="logic" ref="logic"/>
	</bean>
	
	<!-- Handles the update of synchronitzation settings -->
	<bean id="updateSyncSettingsController" class="org.bibsonomy.webapp.controller.actions.SyncSettingsController" scope="request">
		<property name="logic" ref="logic"/>
	</bean>
	
	<!-- Handles sync page -->	
	<bean id="syncPageController" class="org.bibsonomy.webapp.controller.SyncPageController" scope="request">
		<property name="logic" ref="logic"/>
		<property name="syncClient" ref="synchronizationClient" />
	</bean>
		
	<!-- handles synchronization request -->
	<bean id="syncController" class="org.bibsonomy.webapp.controller.ajax.SynchronizationController" scope="request" parent="ajaxController">
		<property name="client" ref="synchronizationClient"/>
	</bean>

	<!-- client bean, handles synchronization -->
	<bean id="realSynchronizationClient" class="org.bibsonomy.sync.SynchronizationClient" lazy-init="true">
		<property name="ownUri" value="${project.home}"/>
	</bean>
	<bean id="mockSynchronizationClient" class="org.bibsonomy.webapp.util.spring.factorybeans.NullFactoryBean"/>
	<alias name="${project.bean.syncclient}" alias="synchronizationClient"/>
	
</beans>