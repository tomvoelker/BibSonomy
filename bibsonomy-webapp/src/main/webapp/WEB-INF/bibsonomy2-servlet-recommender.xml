<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:util="http://www.springframework.org/schema/util"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:jee="http://www.springframework.org/schema/jee"
	xsi:schemaLocation="http://www.springframework.org/schema/beans 
	                    http://www.springframework.org/schema/beans/spring-beans.xsd
	                    http://www.springframework.org/schema/util
	                    http://www.springframework.org/schema/util/spring-util-2.5.xsd
	                    http://www.springframework.org/schema/jee
	                    http://www.springframework.org/schema/jee/spring-jee-3.0.xsd">

    <!-- import recommenderLogic -->
	<jee:jndi-lookup id="recommenderDataSource" jndi-name="jdbc/bibsonomy_recommender"/>
	<import resource="classpath:org/bibsonomy/bibsonomy-recommender-context.xml" />
	
	<!--+
	    | Multiplexing tag recommender
	    +-->
	<bean id="multiplexingTagRecommender" class="org.bibsonomy.recommender.tags.multiplexer.MultiplexingTagRecommender" init-method="init" scope="singleton">
	    <property name="queryTimeout" value="1000" />
		<property name="postModifiers" ref="postModifierList" />
		<property name="tagModifiers" ref="tagFilterList" />
		<property name="resultSelector" ref="selectOneWithoutReplacement" />
		<property name="dbLogic" ref="recommenderLogic" />
	    <property name="localRecommenders" ref="localRecommenderList" />
	</bean>	  

	<util:list id="localRecommenderList" list-class="java.util.ArrayList"> 		
  		<ref bean="mostPopularMixRecommender"/>
  		<ref bean="jensRecommender"/>
	</util:list>
	
	<util:list id="postModifierList" list-class="java.util.ArrayList">
  		<!--+
	    | name mapper
	    +-->
		<bean class="org.bibsonomy.recommender.tags.multiplexer.modifiers.DC09NameToIDMapping">
			<property name="dbLogic" ref="recommenderLogic"/>
		</bean>	
	</util:list>
		
	<util:list id="tagFilterList" list-class="java.util.ArrayList">
  		<!--+
	    | invalid scoring filter
	    +-->
		<bean class="org.bibsonomy.recommender.tags.multiplexer.modifiers.InvalidScoringFilter" />
	</util:list>
	
	<!--+
		| Simple tag recommenders
		+-->
	<bean id="mostPopularByUserRecommender" class="org.bibsonomy.recommender.tags.popular.MostPopularByUserTagRecommender">
		<property name="numberOfTagsToRecommend" value="5"/>
		<property name="cleanTags" value="true"/>
		<property name="dbLogic" ref="recommenderLogic"/>
	</bean>
	<bean id="mostPopularByResourceRecommender" class="org.bibsonomy.recommender.tags.popular.MostPopularByResourceTagRecommender">
		<property name="numberOfTagsToRecommend" value="5"/>
		<property name="cleanTags" value="true"/>
		<property name="dbLogic" ref="recommenderLogic"/>
	</bean>	
	<!--+
	    | merges both into the 0.6 mix 
	    +-->
	<bean id="mostPopularMixRecommender" class="org.bibsonomy.recommender.tags.meta.WeightedMergingTagRecommender">
		<property name="numberOfTagsToRecommend" value="5"/>
		<property name="tagRecommenders">
			<list>
				<ref bean="mostPopularByUserRecommender"/>
				<ref bean="mostPopularByResourceRecommender"/>
			</list>
		</property>
		<property name="weights">
			<list>
				<value>0.4</value>
				<value>0.6</value>
			</list>
		</property>
	</bean>
	
	<bean id="titleRecommender" class="org.bibsonomy.recommender.tags.simple.SimpleContentBasedTagRecommender">
		<property name="cleanTags" value="true"/>
	</bean>
	
	<bean id="allTagsOfUserRecommender"  class="org.bibsonomy.recommender.tags.popular.MostPopularByUserTagRecommender">
		<!-- to get "almost all" tags of the user -->
		<property name="numberOfTagsToRecommend" value="10000"/>
		<property name="cleanTags" value="true"/>
		<property name="dbLogic" ref="recommenderLogic"/>
	</bean>
	
	<!--+ 
	    | comes pretty close to our 'old' recommender from Jens, sorts title tags by their usage count
	    | Note: this tagrecommender is used as a tagrecommender for spammers
	    +-->
	<bean id="jensRecommender" class="org.bibsonomy.recommender.tags.meta.TagsFromFirstWeightedBySecondTagRecommender">
		<property name="firstTagRecommender" ref="titleRecommender"/>
		<property name="secondTagRecommender" ref="allTagsOfUserRecommender"/>
		<property name="numberOfTagsToRecommend" value="5"/>
	</bean>
	
	<!--+ 
	    | strategy for uniform random recommender selection
	    +-->
	<bean id="selectOneWithoutReplacement" class="org.bibsonomy.recommender.tags.multiplexer.strategy.SelectOneWithoutReplacement" scope="singleton">
		<property name="dbLogic" ref="recommenderLogic"/>
	 </bean>
</beans>