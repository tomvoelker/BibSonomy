<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<templates>
	<!--+
		| render spheres cloud
		+-->
	<script id="tplSpheresCloud" type="text/x-jquery-tmpl">
    	<ul class="tagcloud">
    		{{#if items.length}}
				{{each items content="#tplSphere"}}
			{{else}}
				{{getString "spheres.sidebar.empty"}}
			{{/if}}
		</ul>
	</script>

	<!--+
		| render single link in spheres cloud
		+-->
	<script id="tplSphere" type="text/x-jquery-tmpl">
		<li class="{{=tagClass}}"><a href="{{=$view.parent.parent.data.projectHome!}}sphere/{{encodeURI name}}" title='{{=members.length}} {{getString "members"}}'>{{=name}}</a></li>
    </script>
    
    <!--+
    	| custom tags
    	+-->
    <script type="text/javascript">
		$.views.registerTags({
		    getString: function(value, hash, content){
		        return getString(value);
		    },
		    encodeURI: function(value, hash, content){
		        return encodeURIComponent(value);
		    } 
		});
	</script>
	
    <!--+
    	| helper functions
    	+-->
    <script type="text/javascript">
    //<![CDATA[
    	SphereControl.prototype.preprocessSpheres = function(data) {
		    //
	    	// preprocess data
	    	//
		    // 1) determine sizes (FIXME: this is a very simple approach)
		    var sizes = new Array();
		    for (var i=0; i<data.items.length; i++) {
		    	sizes[i] = data.items[i].members.length;
		    }
		    sizes.sort();
		    var first  = sizes[Math.floor(1*data.items.length/4)];
		    var second = sizes[Math.floor(2*data.items.length/4)];
		    var third  = sizes[Math.floor(3*data.items.length/4)];
		    
		    for (var i=0; i<data.items.length; i++) {
		    	var sphere = data.items[i]; 
		    	if (sphere.members.length >= third) {
		    		sphere.tagClass = "taghuge";
		    	} else if (sphere.members.length > second) {
		    		sphere.tagClass = "taglarge";
		    	} else if (sphere.members.length > first) {
		    		sphere.tagClass = "tagnormal";
		    	} else {
		    		sphere.tagClass = "tagtiny";
		    	};
		    }
	    }
	//]]>
	</script>
</templates>