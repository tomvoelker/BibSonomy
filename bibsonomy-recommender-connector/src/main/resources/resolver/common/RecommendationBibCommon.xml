<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">

<sqlMap namespace="RecommendationBibCommon">   

	<resultMap id="tagName" class="tag">
		<result property="name"         column="tag_name"        javaType="string"/>
	</resultMap>	
	
	<resultMap id="postGuess" class="postGuess">
		<result property="contentID"   column="content_id"  javaType="integer" />
		<result property="diff"        column="diff"        javaType="long" />
	</resultMap>	
	
	
	<resultMap id="personName" class="org.bibsonomy.model.PersonName">
	
	</resultMap>
	
	<resultMap id="tagByID" class="tag">
		<result property="id" column="tag_id" javaType="integer" />
		<result property="name" column="tag_name" javaType="string" />
	</resultMap>
	
	<!-- + 
		 | pair
	 	 + -->
    <resultMap id="tagFrequency" class="pair">
        <result property="first"  column="first"  javaType="string"/>
        <result property="second" column="second" javaType="integer"/>
    </resultMap>	
    
    <!-- +
    	 | for greedy loading
    	 + -->
 
    	 
    <resultMap id="resource" class="resource" groupBy="intraHash">
		<result property="interHash"   		column="interHash"       	javaType="string" />
		<result property="intraHash"   		column="intraHash"       	javaType="string" />     	
		<result property="title"       		column="title"           	javaType="string" />
 	</resultMap>
    
    <resultMap id="posts" class="post" groupBy="contentId">
		<result property="contentId"    column="content_id"     javaType="int" />
		<result property="tags"         resultMap="RecommendationBibCommon.tag" />
		<result property="date"         column="date"           javaType="date" />
		<result property="changeDate"	column="change_date" 	javaType="date" />
		<result property="groups"       resultMap="RecommendationBibCommon.group" />
		<result property="user"         resultMap="RecommendationBibCommon.user" />
		<result property="description"  column="description"    javaType="string" />
	</resultMap>
	
	<resultMap id="group" class="group" groupBy="groupId">
		<result property="groupId" column="group"       javaType="int" />
		<result property="name"    column="group_name"  javaType="string" />
	</resultMap>

	<resultMap id="user" class="user" groupBy="name">
		<result property="name" column="user_name" javaType="string" />
	</resultMap>
	
	<resultMap id="tag" class="tag" groupBy="name">
		<result property="name" column="tag_name" javaType="string" />
	</resultMap>
	
	
	<!-- +
		 | for bibtex mapping
		 + -->
	
	<resultMap id="bibtexPost" class="post" extends="RecommendationBibCommon.posts">
		<result property="resource" resultMap="RecommendationBibCommon.bibtex_common" />
	</resultMap>
	
	<resultMap id="bibtex_common" class="bibtex" extends="RecommendationBibCommon.resource">
		<result property="address"        column="address"        javaType="string" />
		<result property="annote"         column="annote"         javaType="string" />
		<result property="booktitle"      column="booktitle"      javaType="string" />
		<result property="chapter"        column="chapter"        javaType="string" />
		<result property="crossref"       column="crossref"       javaType="string" />
		<result property="edition"        column="edition"        javaType="string" />
		<result property="howpublished"   column="howpublished"   javaType="string" />
		<result property="institution"    column="institution"    javaType="string" />
		<result property="journal"        column="journal"        javaType="string" />
		<result property="key"            column="bkey"           javaType="string" />
		<result property="month"          column="month"          javaType="string" />
		<result property="note"           column="note"           javaType="string" />
		<result property="number"         column="number"         javaType="string" />
		<result property="organization"   column="organization"   javaType="string" />
		<result property="pages"          column="pages"          javaType="string" />
		<result property="publisher"      column="publisher"      javaType="string" />
		<result property="school"         column="school"         javaType="string" />
		<result property="series"         column="series"         javaType="string" />
		<result property="type"           column="type"           javaType="string" />
		<result property="volume"         column="volume"         javaType="string" />
		<result property="day"            column="day"            javaType="string" />
		<result property="url"            column="url"            javaType="string" />
		<result property="bibtexKey"      column="bibtexKey"      javaType="string" />
		<result property="misc"           column="misc"           javaType="string" />
		<result property="abstract"       column="bibtexAbstract" javaType="string" />
		<result property="author"         column="author"         javaType="personNameList" />
		<result property="editor"         column="editor"         javaType="personNameList" />
		<result property="year"           column="year"           javaType="string" />
		<result property="entrytype"      column="entrytype"      javaType="string" />
	</resultMap>
	
	<sql id="commonBibtexAttributes">
		b.address, b.annote, b.booktitle, b.chapter, b.crossref, b.edition, b.howpublished,
		b.institution, b.journal, b.bkey, b.month, b.note, b.number, b.organization, b.pages, b.publisher,
		b.school, b.series, b.type, b.volume, b.day, b.url, b.content_id, b.description, b.bibtexKey, b.misc,
		b.bibtexAbstract, b.user_name, b.date, b.title, b.author, b.editor, b.year, b.entrytype
	</sql>
	
	<!-- +
		 | for bookmark mapping
		 + -->
		 
	<resultMap id="bookmark" class="bookmark" extends="RecommendationBibCommon.resource">
    	<result property="url"      column="book_url"  javaType="string" />
	</resultMap>

	<resultMap id="bookmarkPost" class="post" extends="RecommendationBibCommon.posts">
		<result property="resource"   resultMap="RecommendationBibCommon.bookmark" />
	</resultMap>

	<sql id="bookmarkAttributes">
		b.content_id, b.book_description as title, b.book_extended as description, b.user_name, b.date, b.book_url_hash AS intraHash, b.book_url_hash AS interHash, t.change_date
	</sql>	
    
</sqlMap>