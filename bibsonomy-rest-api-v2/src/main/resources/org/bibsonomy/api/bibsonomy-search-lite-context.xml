<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:util="http://www.springframework.org/schema/util"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
						http://www.springframework.org/schema/beans/spring-beans.xsd
						http://www.springframework.org/schema/util
						http://www.springframework.org/schema/util/spring-util.xsd">

    <!--
        Trimmed-down variant of bibsonomy-search-context.xml that omits the legacy
        database/model imports (already loaded by the Boot app) but keeps the search
        datasource and supporting beans needed by the Elasticsearch search stack.
    -->

    <!-- Reuse the primary SQL map client to avoid loading the outdated search iBatis mappings -->
    <alias name="sqlMapClient" alias="searchSqlMapClient" />

    <bean id="searchDataSource" class="${database.datasource.class}" destroy-method="close" parent="basicDataSource">
        <property name="driverClassName" value="${database.search.driverClassName}" />
        <property name="url" value="${database.search.url}" />
        <property name="username" value="${database.search.username}" />
        <property name="password" value="${database.search.password}" />
        <property name="maxIdle" value="${database.search.maxIdle}" />
        <property name="maxTotal" value="${database.search.maxTotal}" />
        <property name="maxWaitMillis" value="${database.search.maxWait}" />
        <property name="removeAbandonedOnMaintenance" value="${database.search.removeAbandoned}" />
        <property name="removeAbandonedOnBorrow" value="${database.search.removeAbandoned}" />
        <property name="removeAbandonedTimeout" value="${database.search.removeAbandonedTimeout}" />
    </bean>

    <alias name="dbSessionFactory" alias="searchSessionFactory" />

    <bean id="searchInfoLogic" class="org.bibsonomy.search.SearchInfoDBLogic">
        <property name="sessionFactory" ref="searchSessionFactory" />
    </bean>

    <!-- Lightweight file extraction stub to avoid legacy PDF/cache wiring -->
    <bean id="fileContentExtractorService" class="MinimalFileContentExtractorService" />

    <!-- search modules -->
    <import resource="classpath:org/bibsonomy/bibsonomy-search-post-context.xml" />
    <import resource="classpath:org/bibsonomy/bibsonomy-search-person-context.xml" />
    <import resource="classpath:org/bibsonomy/bibsonomy-search-project-context.xml" />
    <import resource="classpath:org/bibsonomy/bibsonomy-search-group-context.xml" />
</beans>
