<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">

<sqlMap namespace="Bookmark">
	<typeAlias alias="bookmark" type="org.bibsonomy.model.Bookmark" />
	<typeAlias alias="HomePageforBookmark" type="org.bibsonomy.ibatis.params.HomePageforBookmark" />

	<resultMap id="bookmarks" class="bookmark">
		<result property="description" column="book_description" javaType="string" />
		<result property="extended"    column="book_extended"    javaType="string" />
		<result property="userName"    column="user_name"        javaType="string" />
		<result property="date"        column="date"             javaType="java.util.Date" />
		<result property="urlHash"     column="book_url_hash"    javaType="string" />
		<result property="url"         column="book_url"         javaType="string" />
		<result property="count"       column="book_url_ctr"     javaType="int" />
	</resultMap>


	<select id="getHomePageBookmark" resultMap="bookmarks" parameterClass="HomePageForBookmark">
 SELECT bb.content_id,bb.book_url_hash,bb.book_description,bb.book_extended,bb.date,bb.user_name,bb.book_url,bb.book_url_ctr,t.tag_name"
 FROM 
 (SELECT b.content_id,b.book_url_hash,b.book_description,b.book_extended,b.date,b.user_name,u.book_url,u.book_url_ctr" 
 FROM bookmark b, urls u 
 WHERE b.group = #groupType# 
 AND u.book_url_hash = b.book_url_hash
 ORDER BY date DESC #itemCount#) AS bb LEFT OUTER JOIN tas AS t ON bb.content_id=t.content_id 
 ORDER BY bb.date DESC, bb.content_id DESC;

</select>
</sqlMap>