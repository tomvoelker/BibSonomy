<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">

<sqlMap namespace="BibTexCommon">
	<resultMap id="bibtexs" class="bibtex" groupBy="contentId">
		<result property="contentId"      column="content_id"     javaType="int" />
		<result property="tags"           resultMap="Common.tags" />
		<result property="title"          column="title"          javaType="string" />
		<result property="address"        column="address"        javaType="string" />
		<result property="annote"         column="annote"         javaType="string" />
		<result property="booktitle"      column="booktitle"      javaType="string" />
		<result property="chapter"        column="chapter"        javaType="string" />
		<result property="crossref"       column="crossref"       javaType="string" />
		<result property="edition"        column="edition"        javaType="string" />
		<result property="howpublished"   column="howpublished"   javaType="string" />
		<result property="institution"    column="institution"    javaType="string" />
		<result property="journal"        column="journal"        javaType="string" />
		<result property="bkey"           column="bkey"           javaType="string" />
		<result property="month"          column="month"          javaType="string" />
		<result property="note"           column="note"           javaType="string" />
		<result property="number"         column="number"         javaType="string" />
		<result property="organization"   column="organization"   javaType="string" />
		<result property="pages"          column="pages"          javaType="string" />
		<result property="publisher"      column="publisher"      javaType="string" />
		<result property="school"         column="school"         javaType="string" />
		<result property="series"         column="series"         javaType="string" />
		<result property="type"           column="type"           javaType="string" />
		<result property="volume"         column="volume"         javaType="string" />
		<result property="day"            column="day"            javaType="string" />
		<result property="url"            column="url"            javaType="string" />
		<result property="description"    column="description"    javaType="string" />
		<result property="bibtexKey"      column="bibtexKey"      javaType="string" />
		<result property="misc"           column="misc"           javaType="string" />
		<result property="bibtexAbstract" column="bibtexAbstract" javaType="string" />
		<result property="userName"       column="user_name"      javaType="string" />
		<result property="date"           column="date"           javaType="date" />
		<result property="title"          column="title"          javaType="string" />
		<result property="author"         column="author"         javaType="string" />
		<result property="editor"         column="editor"         javaType="string" />
		<result property="year"           column="year"           javaType="string" />
		<result property="entrytype"      column="entrytype"      javaType="string" />
		<result property="ctr"            column="ctr"            javaType="int" />
	</resultMap>

	<sql id="bibtexAttributes">
		b.address,b.annote,b.booktitle,b.chapter,b.crossref,b.edition,b.howpublished,
		b.institution,b.journal,b.bkey,b.month,b.note,b.number,b.organization,b.pages,b.publisher,
		b.school,b.series,b.type,b.volume,b.day,b.url,b.content_id,b.description,b.bibtexKey,b.misc,
		b.bibtexAbstract,b.user_name,b.date,b.title,b.author,b.editor,b.year,b.entrytype
	</sql>

	<sql id="bibtexAttributes2">
		b2.address,b2.annote,b2.booktitle,b2.chapter,b2.crossref,b2.edition,b2.howpublished,
		b2.institution,b2.journal,b2.bkey,b2.month,b2.note,b2.number,b2.organization,b2.pages,b2.publisher,
		b2.school,b2.series,b2.type,b2.volume,b2.day,b2.url,b2.content_id,b2.description,b2.bibtexKey,
		b2.misc,b2.bibtexAbstract,b2.user_name,b2.date,b2.title,b2.author,b2.editor,b2.year,b2.entrytype
	</sql>

	<sql id="bibtexSimHash">
		b.simhash$simHash$ = h.hash AND h.type = $simHash$
	</sql>

	<sql id="bibtexSimHash2">
		b2.simhash$simHash$ = h.hash AND h.type = $simHash$
	</sql>

	<sql id="duplicatesCount">
		SELECT b0.simhash1,count(b0.simhash1) AS ctr
		FROM bibtex b0
		WHERE b0.user_name = #userName#
		GROUP BY b0.simhash1 HAVING ctr > 1
	</sql>
</sqlMap>