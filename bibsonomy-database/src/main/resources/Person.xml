<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">

<sqlMap namespace="Person">

	<select id='getMaxId' resultClass='int'>
		SELECT person_id FROM person ORDER BY person_id DESC LIMIT 0,1
	</select>
	
	<select id='getMaxNameId' resultClass='int'>
		SELECT id FROM person_name ORDER BY id DESC LIMIT 0,1
	</select>

	<select id="getPersonById" resultMap="PersonCommon.person" parameterClass="int">
		SELECT <include refid="commonPersonColumns"/> FROM person 
			WHERE person.person_id = #id#
	</select>
	
	<select id="getPersonByUser" resultMap="PersonCommon.person" parameterClass="String">
		SELECT <include refid="commonPersonColumns"/> FROM person
			WHERE person.user_name = #user#
	</select>	
	
	<insert id="insertPerson" parameterClass="org.bibsonomy.model.Person">
		INSERT INTO person (<include refid="commonPersonColumns"/>)
			VALUES (<include refid="insertPersonAttributes"/>)
	</insert>
	
	<insert id='insertName' parameterClass="org.bibsonomy.model.PersonName">
		INSERT INTO person_name(first_name, last_name, person_id, is_main)
			VALUES (#firstName#, #lastName#, #personId#, #isMain#)
	</insert>
	
	<insert id='addResourceRelation' parameterClass='org.bibsonomy.model.PersonResourceRelation'>
		INSERT INTO pub_person (<include refid="commonPubPersonColumns"/>)
			VALUES (<include refid="commonPubPersonAttributes" />)
	</insert>
	
	<select id='getNames' resultMap='PersonCommon.personName' parameterClass='int'>
		SELECT <include refid='commonPersonNameColumns'/> FROM person_name 
			WHERE person_name.person_id = #id#
	</select>
	
	<update id='updatePerson' parameterClass='org.bibsonomy.model.Person'>
		UPDATE person SET academic_degree = #academicDegree#, orcid = #orcid#, post_ctr = #postCounter#, user_name = #user#
			WHERE person.person_id = #id#
	</update> 
	
	<select id="getPersonNameById" resultMap="PersonCommon.personName" parameterClass="int">
		SELECT <include refid="commonPersonNameColumns"/> FROM person_name
			WHERE person_name.id = #id#
	</select>
	
	<update id="updatePersonName" parameterClass='org.bibsonomy.model.PersonName'>
		Update person_name SET is_main = 1 
			WHERE person_name.id = #id#
	</update>
	
</sqlMap>