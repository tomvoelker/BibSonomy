<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">
<sqlMap namespace="StatisticCommon">
	<sql id="statisticRestrictions">
		<dynamic prepend="WHERE">
			<include refid="statisticDateRestriction" />
			<include refid="statisticUsersToExcludeRestriction" />
		</dynamic>
	</sql>
	
	<sql id="statisticDateRestriction">
		<isNotNull prepend="AND" property="startDate">
			date >= #startDate#
		</isNotNull>
	</sql>
	
	<sql id="statisticUsersToExcludeRestriction">
		<isNotEmpty prepend="AND" property="usersToExclude">
			user_name NOT IN (
			<iterate property="usersToExclude" conjunction=",">
				#usersToExclude[]#
			</iterate>)
		</isNotEmpty>
	</sql>
	
	<sql id="statisticRestrictionsWithContentType">
		<dynamic prepend="WHERE">
			<isGreaterThan prepend="AND" property="contentType" compareValue="0">
				content_type = #contentType#
			</isGreaterThan>
			<include refid="statisticDateRestriction" />
			<include refid="statisticUsersToExcludeRestriction" />
		</dynamic>
	</sql>
</sqlMap>