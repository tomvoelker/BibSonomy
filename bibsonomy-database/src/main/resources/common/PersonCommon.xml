<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">

<!-- FIXME: remove lacy loading -->
<sqlMap namespace="PersonCommon">
	<resultMap id="abstractPerson" class="person" groupBy="personId">
		<result property="personChangeId"   column="p_person_change_id"    javaType="int" />
		<result property="personId"         column="person_id"           javaType="string" />
		
		<result property="orcid"            column="orcid"               javaType="string" />
		<result property="researcherid"     column="researcherid"        javaType="string" />
		<result property="academicDegree"   column="academic_degree"     javaType="string" />
		<result property="dnbPersonId"      column="dnb_person_id"       javaType="string" />
		<result property="gender"           column="gender"              javaType="gender" />
		<result property="postCounter"      column="post_ctr"            javaType="integer" />
		<result property="changedBy"        column="log_changed_by"      javaType="string" />
		<result property="changeDate"       column="log_changed_at"      javaType="date" />
		<result property="user"             column="user_name"           javaType="string" />
		
		<result property="college"          column="college"           	 javaType="string" />
		<result property="homepage"         column="homepage"     		 javaType="url" />
		<result property="email"            column="email"           	 javaType="string" />
	</resultMap>
	
	<resultMap id="lazyLoadingPerson" class="person" extends="abstractPerson">
		<result property="names"            column="person_id"           javaType="java.util.ArrayList" select="getNames" />
		<result property="additionalKeys"   column="person_id"           javaType="java.util.LinkedList" select="getAdditionalKeys" />
	</resultMap>
	
	<resultMap id="personWithNamesPrefilled" class="person" extends="abstractPerson">
		<result property="names"            resultMap="PersonCommon.personName" />
	</resultMap>

	<resultMap id="simplePerson" class="person" groupBy="personId">
		<result property="personId"         column="person_id"           javaType="string" />
		<result property="academicDegree"   column="academic_degree"     javaType="string" />
		<result property="names" resultMap="PersonCommon.simplePersonName" />
	</resultMap>

	<resultMap id="personName" class="personName" groupBy="personNameChangeId">
		<result property="personNameChangeId"  column="n_person_change_id"  javaType="int" />
		<result property="firstName"       column="first_name"        javaType="string" />
		<result property="lastName"        column="last_name"         javaType="string" />
		<result property="personId"        column="person_id"         javaType="string" />
		<result property="isMain"          column="is_main"           javaType="boolean" />
		<result property="changedBy"       column="log_changed_by"    javaType="string" />
		<result property="changedAt"       column="log_changed_at"    javaType="date" />
	</resultMap>

	<resultMap id="simplePersonName" class="personName" groupBy="personNameChangeId">
		<result property="personNameChangeId" column="person_name_change_id" javaType="int" />
		<result property="firstName"       column="first_name"        javaType="java.lang.String" />
		<result property="lastName"        column="last_name"         javaType="java.lang.String" />
	</resultMap>

	<resultMap id="abstractResourcePersonRelation" class="personResourceRelation">
		<result property="personRelChangeId" column="r_person_change_id" javaType="int" />
		<result property="qualifying"        column="qualifying"       javaType="int" />
		<result property="relationType"      column="relator_code"     javaType="personResourceRelationType" />
		<result property="changedBy"         column="log_changed_by"   javaType="java.lang.String" />
		<result property="changedAt"         column="log_changed_at"   javaType="java.util.Date" />
		<result property="personIndex"       column="person_index"     javaType="int" />
	</resultMap>
	
	<resultMap id="lazyLoadingResourcePersonRelation" class="personResourceRelation" groupBy="personRelChangeId" extends="abstractResourcePersonRelation">
		<result property="person"          column="person_id"       javaType="person"       select="getPersonById" />
		<result property="post"            column="simhash1"        javaType="bibtex"       select="getPosts"/>
	</resultMap>
	
	<resultMap id="resourcePersonRelationWithPersonPrefilled" class="personResourceRelation" groupBy="personRelChangeId" extends="abstractResourcePersonRelation">
		<result property="person"          resultMap="PersonCommon.personWithNamesPrefilled" />
	</resultMap>
	
	<resultMap id="preFilledResourcePersonRelation" class="personResourceRelation" groupBy="personRelChangeId" extends="abstractResourcePersonRelation">
		<result property="person"          column="person_id"       javaType="person"       select="getPersonById" />
		<result property="post"            resultMap="BibTexCommon.bibtexPost" />
	</resultMap>
	
	<resultMap id="preFilledCommunityResourcePersonRelation" class="personResourceRelation" groupBy="personRelChangeId" extends="abstractResourcePersonRelation">
		<result property="person"          column="person_id"       javaType="person"       select="getPersonById" />
		<result property="post"            resultMap="GoldStandardPublicationCommon.goldStandardPost" />
	</resultMap>
	
	<resultMap id="personMatch" class="personMatch">
		<result property="matchID" 			column="match_id"/>
		<result property="state" 			column="state"/>
		<result property="targetPerson"     column="target_person_id"       javaType="person"						select="getPersonById"/>
		<result property="sourcePerson"     column="source_person_id"       javaType="person"						select="getPersonById"/>
		<result property="userDenies"		column="match_id"		  		javaType="string"						select="getDeniesForMatch" />
		<result property="targetPosts"		column="target_person_id"		javaType="org.bibsonomy.model.Post"		select="getPostsForPerson" />
		<result property="sourcePosts"		column="source_person_id"		javaType="org.bibsonomy.model.Post"		select="getPostsForPerson" />
	</resultMap>
	
	<resultMap id="phdRecommendation" class="org.bibsonomy.model.PhDRecommendation">
		<result property="confidence" column="confidence"/>
		<result property="rank" column="rank"/>
		<result property="doctor"           column="doctor_id"       javaType="person"		select="getPersonById"/>
		<result property="advisor"          column="advisor_id"       javaType="person"		select="getPersonById"/>
	</resultMap>

	<resultMap id="additionalKey" class="additionalKey">
		<result property="keyName" column="key_name" javaType="java.lang.String"/>
		<result property="keyValue" column="key_value" javaType="java.lang.String"/>
	</resultMap>

	<!-- FIXME: use table alias instead of full table name -->
	<sql id="commonPersonColumns">
		person.person_change_id as p_person_change_id, person.person_id, person.academic_degree, person.orcid, person.researcherid, person.post_ctr, person.log_changed_by, person.log_changed_at, person.user_name, person.dnb_person_id, gender, person.college, person.email, person.homepage
	</sql>
	
	<sql id="commonPersonColumnsPlain">
		person.person_change_id, person.person_id, person.academic_degree, person.orcid, person.researcherid, person.post_ctr, person.log_changed_by, person.log_changed_at, person.user_name, person.dnb_person_id, gender, person.college, person.email, person.homepage
	</sql>
	
	<sql id="commonPersonNameColumns">
		person_name.person_change_id as n_person_change_id, person_name.first_name, person_name.last_name, person_name.person_id, person_name.is_main, person_name.log_changed_by, person_name.log_changed_at
	</sql>
	
	<sql id="commonPersonNameColumnsPlain">
		person_name.person_change_id as n_person_change_id, person_name.first_name, person_name.last_name, person_name.person_id, person_name.is_main, person_name.log_changed_by, person_name.log_changed_at
	</sql>
	
	<sql id="insertPersonAttributes">
		#personChangeId#, #personId#, #academicDegree#, #orcid#, #researcherid#, #postCounter#, #changedBy#, #changeDate#, #user#, #dnbPersonId#, #gender#, #college#, #email#, #homepage#
	</sql>
	
	<sql id="commonResourcePersonRelationAttributes">
		#personRelChangeId#, #post.resource.interHash#, #post.resource.intraHash#, #qualifying#, #person.personId#, #relationType.relatorCode# , #changedBy#, #changedAt#, #personIndex#
	</sql>
	
	<sql id="commonResourcePersonRelationColumns">
		pub_person.person_change_id as r_person_change_id, pub_person.simhash1, pub_person.simhash2, pub_person.qualifying, pub_person.person_id, pub_person.relator_code, pub_person.log_changed_by, pub_person.log_changed_at, pub_person.person_index
	</sql>
	
	<sql id="commonResourcePersonRelationColumnsPlain">
		pub_person.person_change_id, pub_person.simhash1, pub_person.simhash2, pub_person.qualifying, pub_person.person_id, pub_person.relator_code, pub_person.log_changed_by, pub_person.log_changed_at, pub_person.person_index
	</sql>
	
	<sql id="commonResourcePersonRelationColumns2">
		b2.person_change_id as r_person_change_id, b2.simhash1, b2.simhash2, b2.qualifying, b2.person_id, b2.relator_code, b2.log_changed_by, b2.log_changed_at, b2.person_index
	</sql>

	<sql id="allPubPersonRelationAttributes">
		person_change_id, simhash1, simhash2, relator_code, person_index, person_id, qualifying, log_changed_at, log_changed_by
	</sql>

	<sql id="commonPersonAdditionalKeysColumns">
		person_id, key_name, key_value
	</sql>
</sqlMap>