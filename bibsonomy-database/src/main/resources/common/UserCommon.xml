<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">

<sqlMap namespace="UserCommon">

	<resultMap id="userForGroup" extends="Common.user" class="user">
		<result property="homepage"   column="user_homepage"  javaType="url"  />
		<result property="realname"   column="user_realname"  javaType="string" />
	</resultMap>
	
	<resultMap id="userWithWeight" extends="Common.user" class="user">
		<result property="prediction" column="weight"         javaType="integer"/>
	</resultMap>

	<resultMap id="user" class="user" extends="userForGroup">
		<result property="apiKey"           column="api_key"       javaType="string" />
		<result property="birthday"         column="birthday"      javaType="date" />
		<result property="email"            column="user_email"    javaType="string" />				
		<result property="gender"           column="gender"        javaType="string" />
		<result property="hobbies"          column="hobbies"       javaType="string" />
		<result property="interests"        column="interests"     javaType="string" />
		<result property="IPAddress"        column="ip_address"    javaType="string" />
		<result property="openURL"          column="openurl"       javaType="string" />
		<result property="password"         column="user_password" javaType="string" />
		<result property="place"            column="place"         javaType="string" />
		<result property="profession"       column="profession"    javaType="string" />
		<result property="institution"      column="institution"   javaType="string" />
		<result property="registrationDate" column="reg_date"      javaType="date" />
		<result property="spammer"          column="spammer"       javaType="boolean" />
		<result property="role"             column="role"          javaType="Role" />	
		<result property="updatedBy"        column="updated_by"    javaType="string" />
		<result property="updatedAt"	    column="updated_at"    javaType="date" />
		<result property="toClassify"       column="to_classify"   javaType="integer" />
		<result property="reminderPassword" column="tmp_password"  javaType="string" />
		<result property="reminderPasswordRequestDate" column="tmp_request_date"  javaType="date" />
		<result property="ldapId" 			column="ldapUserId"		javaType="string" />
		<result property="openID" 			column="openID"  		javaType="string" />			
	</resultMap>
	
	<resultMap id="userWithActivationCode"  class="user" extends="user"> 
		<result property="activationCode"   column="activation_code" javaType="string" />
	</resultMap>

	<resultMap id="userWithSettings"  class="user" extends="user"> 
		<result property="settings"   resultMap="UserCommon.userSettings"/>
	</resultMap>
	
	<resultMap id="userSettings" class="userSettings">
		<result property="listItemcount"   	column="list_itemcount" 	javaType="integer" />	
		<result property="tagboxMinfreq"   	column="tagbox_minfreq" 	javaType="integer" />
		<result property="tagboxMaxCount"  	column="tagbox_max_count" 	javaType="integer" />
		<result property="isMaxCount"      	column="is_max_count"   	javaType="boolean" />
		<result property="tagboxSort"      	column="tagbox_sort"    	javaType="integer" />
		<result property="tagboxStyle"     	column="tagbox_style"   	javaType="integer" />
		<result property="tagboxTooltip"   	column="tagbox_tooltip" 	javaType="integer" />	
		<result property="logLevel"        	column="log_level"      	javaType="integer" />
		<result property="defaultLanguage" 	column="lang" 	       		javaType="string" />	
		<result property="confirmDelete"   	column="confirmDelete"  	javaType="boolean" />
		<result property="profilePrivlevel" column="profilegroup"   	javaType="ProfilePrivlevel" />	
		<result property="showBookmark"   	column="show_bookmark"  	javaType="boolean" />
		<result property="showBibtex"   	column="show_bibtex"  		javaType="boolean" />
		<result property="simpleInterface"  column="simple_interface"  	javaType="boolean" />	
	</resultMap>	


	<!-- IMPORTANT: changing this requires you to change "insertUserAttributes", too! -->
	<sql id="allUserAttributes">
		<include refid="commonUserAttributes"/>,
		<include refid="userSettingsAttributes"/>
	</sql>

	<!-- IMPORTANT: changing this requires you to change "insertUserAttributes", too! -->
	<sql id="commonUserAttributes">
		user_name, user_realname,
		user_password, api_key, openurl, tmp_password, tmp_request_date,
		role, ip_address, reg_date, spammer, updated_by, updated_at, to_classify, 
		user_email, user_homepage, birthday, gender, hobbies, interests, place, profession, institution
	</sql>
	
	<!-- IMPORTANT: changing this requires you to change "insertUserAttributes", too! -->
	<sql id="userSettingsAttributes">
		tagbox_style, tagbox_sort, tagbox_minfreq, tagbox_tooltip, list_itemcount, 
		lang, log_level, confirmDelete, profilegroup, tagbox_max_count, is_max_count, 
		show_bookmark, show_bibtex, simple_interface
	</sql>	

	<!-- 
		for insert and update statements matching 'allUserAttributes'  
		-->
	<sql id="insertUserAttributes">
		#name#, #realname#,
		#password#, #apiKey#, #openURL#,
		<isNotNull property="reminderPassword">#reminderPassword#,#reminderPasswordRequestDate#,</isNotNull>
		<isNull property="reminderPassword">NULL,DEFAULT(tmp_request_date),</isNull>
		#role#, #IPAddress#, #registrationDate#, #spammer#, #updatedBy#, #updatedAt#, #toClassify#, 
		#email#, #homepage#, #birthday#, #gender#, #hobbies#, #interests#, #place#, #profession#, #institution#,
		#settings.tagboxStyle#, #settings.tagboxSort#, #settings.tagboxMinfreq#, #settings.tagboxTooltip#, #settings.listItemcount#, 
		<isNotNull property="settings.defaultLanguage">#settings.defaultLanguage#,</isNotNull>
		<isNull property="settings.defaultLanguage">DEFAULT(lang),</isNull> 
		#settings.logLevel#, #settings.confirmDelete#, #settings.profilePrivlevel#, #settings.tagboxMaxCount#, #settings.isMaxCount#, 
		#settings.showBookmark#, #settings.showBibtex#, #settings.simpleInterface#
	</sql>

	<sql id="updateUserProfileAttributes">
	    birthday = #birthday#, 
		user_realname = #realname#,
		gender = #gender#,
		user_email = #email#,
		user_homepage = #homepage#,
		openurl = #openURL#,
		profession = #profession#,
		institution = #institution#, 
		interests = #interests#,
		hobbies = #hobbies#,
		place = #place#
	</sql>
	
	<sql id="updateUserSettingsAttributes">
		log_level = #settings.logLevel#, 
		lang = #settings.defaultLanguage#,
		list_itemcount = #settings.listItemcount#,
		tagbox_tooltip = #settings.tagboxTooltip#,
		tagbox_minfreq = #settings.tagboxMinfreq#,
		tagbox_max_count = #settings.tagboxMaxCount#,
		tagbox_sort = #settings.tagboxSort#,
		tagbox_style = #settings.tagboxStyle#,
		is_max_count = #settings.isMaxCount#,
		confirmDelete = #settings.confirmDelete#, 
		show_bookmark = #settings.showBookmark#,
		show_bibtex = #settings.showBibtex#, 
		simple_interface = #settings.simpleInterface#
	</sql>
</sqlMap>