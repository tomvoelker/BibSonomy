<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">

<sqlMap namespace="SearchGoldStandardPublicationCommon">
	<resultMap id="goldStandardPublicationWithoutPrivnote" class="goldStandardPublication" extends="BibTexCommon.bibtex_common_without_privnote">
		<!-- to get a GoldStandardPublication object instead of a normal publication -->
	</resultMap>
	
	<resultMap id="searchGoldStandardPublicationPost" class="searchPost" extends="GoldStandardPublicationCommon.posts">
		<result property="groups"      resultMap="Common.group" />
		<result property="resource"    resultMap="SearchGoldStandardPublicationCommon.goldStandardPublicationWithoutPrivnote" />
		<!-- this is intended misuse - it would be better to call lastTasId lastResoucePostId or so -->
		<result property="lastTasId"   column="content_id" />
		<result property="users"		resultMap="SearchCommon.simpleUser" />
	</resultMap>

	<resultMap id="searchGoldStandardPublicationPostWithRelations" class="searchPost" extends="SearchGoldStandardPublicationCommon.searchGoldStandardPublicationPost">
		<result property="resourcePersonRelations" resultMap="SearchPersonCommon.simplePersonResourceRelationWithoutPost" />
	</resultMap>

	<!-- List of selected columns in query from a single source, for example just the bibtex table.
	All column names will have the prefix b. for the table -->
	<sql id="allGoldStandardPublicationAttributesWithSimHashesSearchSingle">
		<include refid="allGoldStandardPublicationAttributesSearchSingle"/>,
		<include refid="bibtexSimHashes"/>
	</sql>

	<!-- List of selected columns in query from two sources after a JOIN, for example the bibtex joined with gold_standard table.
	All column names will have the prefix b. or gb. for the tables respectively. -->
	<sql id="allGoldStandardPublicationAttributesWithSimHashesSearchMultiple">
		<include refid="allGoldStandardPublicationAttributesSearchMultiple"/>,
		<include refid="bibtexSimHashes"/>
	</sql>

	<sql id="allGoldStandardPublicationAttributesSearchSingle">
		b.content_id, b.address, b.annote, b.booktitle, b.chapter, b.crossref, b.edition, b.howpublished,
		b.institution, b.journal, b.bkey, b.month, b.note, b.number, b.organization, b.pages, b.publisher,
		b.school, b.series, b.type, b.volume, b.day, b.url, b.description, b.bibtexKey, b.misc,
		b.bibtexAbstract, b.user_name, b.date, b.title, b.author, b.editor, b.year, b.entrytype, COALESCE(b.approved, 0) AS approved
	</sql>
	
	<sql id="allGoldStandardPublicationAttributesSearchMultiple">
		b.content_id, b.address, b.annote, b.booktitle, b.chapter, b.crossref, b.edition, b.howpublished,
		b.institution, b.journal, b.bkey, b.month, b.note, b.number, b.organization, b.pages, b.publisher,
		b.school, b.series, b.type, b.volume, b.day, b.url, b.description, b.bibtexKey, b.misc,
		b.bibtexAbstract, b.user_name, b.date, b.title, b.author, b.editor, b.year, b.entrytype, COALESCE(gb.approved, 0) AS approved
	</sql>

	<sql id="goldStandardOtherFields">
		'public' AS group_name, 1 AS count, -1 AS rating, -1 AS number_of_ratings, p.user_name AS other_user_name
	</sql>

	<sql id="goldStandardOtherFieldsDummyOtherUsers">
		'public' AS group_name, 1 AS count, -1 AS rating, -1 AS number_of_ratings, NULL AS other_user_name
	</sql>
</sqlMap>